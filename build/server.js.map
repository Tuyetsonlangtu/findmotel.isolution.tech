{"version":3,"file":"../../server.js","sources":["webpack:///webpack/bootstrap 022d8b42b7b4562bdac2","webpack:///external \"express\"","webpack:///./src/common/config.js","webpack:///external \"mongoose\"","webpack:///external \"passport\"","webpack:///./src/server/server.js","webpack:///external \"babel-polyfill\"","webpack:///./src/common/common.js","webpack:///./src/models/index.js","webpack:///./src/models/user.js","webpack:///./src/server/passport/auth.facebook.js","webpack:///./src/server/passport/config.js","webpack:///./src/server/routes/api/index.js","webpack:///./src/server/routes/api/user.route.js","webpack:///./src/server/routes/index.js","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"passport-facebook\"","webpack:///external \"path\"","webpack:///external \"randomstring\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 022d8b42b7b4562bdac2","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","\nif (process.env.BROWSER) {\n  throw new Error('Do not import `config.js` from inside the client-side code.');\n}\n\nconst port = 4000;\nmodule.exports = {\n  // Node.js app\n  port: process.env.PORT || port,\n\n  // API Gateway\n  api: {\n    // API URL to be used in the client-side code\n    clientUrl: process.env.API_CLIENT_URL || '',\n    // API URL to be used in the server-side code\n    serverUrl: process.env.API_SERVER_URL || `http://localhost:${process.env.PORT || port}`,\n  },\n\n  analytics: {\n    googleTrackingId: process.env.GOOGLE_TRACKING_ID, // UA-XXXXX-X\n  },\n\n  database: {\n    mongoose: {\n      databaseURI : \"mongodb://10.0.15.5:27017/ISolution-FindMotel\",\n      logging: false\n    }\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/config.js\n// module id = 1\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 3\n// module chunks = 0","/**\n * Created by hien.tran on 5/29/2017.\n */\n\n\"use strict\";\nimport path from 'path';\nimport express from 'express';\nimport cookieParser from 'cookie-parser';\nimport bodyParser from 'body-parser';\nimport config from '../common/config';\nimport passport from 'passport';\nimport publicApi from './routes';\nimport privateApi from './routes/api';\n\nlet app = express();\n\napp.use(express.static(path.join(__dirname, 'public')));\napp.use(cookieParser());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\n\napp.use(\"/\", publicApi);\napp.use(passport.initialize());\napp.use(\"/api\", privateApi);\n\napp.listen(config.port, () => {\n  console.info(`The server is running at http://localhost:${config.port}/`);\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/server.js\n// module id = 4\n// module chunks = 0","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 5\n// module chunks = 0","/**\n * Created by hientran on 6/3/17.\n */\n\nimport randomString from 'randomstring';\n\n\nfunction generateCode(num) {\n  return randomString.generate(num);\n}\n\nexport { generateCode }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/common/common.js\n// module id = 6\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\"use strict\";\nimport mongoose from 'mongoose';\nimport config from '../common/config';\nimport user from './user';\n\n//Config mongodb\nlet conn = mongoose.createConnection(config.database.mongoose.databaseURI)\nlet Schema = mongoose.Schema;\nmongoose.Promise = Promise;\nmongoose.set('debug', config.database.mongoose.logging);\n\n\nconst User = conn.model(user.name, user.schema);\n\nexport { User}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/index.js\n// module id = 7\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\"use strict\";\nimport mongoose from 'mongoose';\nimport { generateCode } from '../common/common';\nlet Schema = mongoose.Schema;\n\nfunction metSalt(){\n  return generateCode(50);\n}\n\nfunction metSetId() {\n  return generateCode(12);\n}\n\nconst User = new Schema({\n  _id: {\n    type: String,\n    default: generateCode,\n    index: true,\n    unique: true\n  },\n  username:{\n    type: String,\n    unique: true,\n  },\n  password:{\n    type: String,\n    unique: true,\n  },\n  salt: {\n    type: String,\n    default: metSalt\n  },\n  fullname: {\n    type: String,\n    unique: true,\n    sparse: true,\n    dropDups: true\n  },\n  email: {\n    type: String,\n    unique: true,\n    sparse: true,\n    dropDups: true\n  },\n  phone: String,\n  isAdmin: {\n    type: Boolean,\n    default: false\n  },\n  accessToken: String,\n  expirationDate: Date,\n  isEnabled: {\n    type: Boolean,\n    default: true\n  },\n  createdAt: {\n    type: Date\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n});\n\nexport default {\n  name: 'User',\n  schema: User\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/models/user.js\n// module id = 8\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\nimport passport from 'passport';\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\nimport config from './config';\nimport {User} from '../../models';\n\npassport.use(new FacebookStrategy({\n  clientID: config.auth.facebook.clientID,\n  clientSecret: config.auth.facebook.clientSecret,\n  callbackURL: config.auth.facebook.callbackURL,\n  profileFields: ['displayName', 'name', 'email', 'link', 'locale', 'timezone'],\n  passReqToCallback: true,\n}, (req, accessToken, refreshToken, profile, done) => {\n\n  const loginName = 'facebook';\n  const claimType = 'urn:facebook:access_token';\n\n  const fooBar = async () => {\n    if (req.user) {\n      const userLogin = await UserLogin.findOne({\n        attributes: ['name', 'key'],\n        where: { name: loginName, key: profile.id },\n      });\n      if (userLogin) {\n        // There is already a Facebook account that belongs to you.\n        // Sign in with that account or delete it, then link it with your current account.\n        done();\n      } else {\n        const user = await User.create({\n          id: req.user.id,\n          email: profile._json.email,\n          logins: [\n            { name: loginName, key: profile.id },\n          ],\n          claims: [\n            { type: claimType, value: profile.id },\n          ],\n          profile: {\n            displayName: profile.displayName,\n            gender: profile._json.gender,\n            picture: `https://graph.facebook.com/${profile.id}/picture?type=large`,\n          },\n        }, {\n          include: [\n            { model: UserLogin, as: 'logins' },\n            { model: UserClaim, as: 'claims' },\n            { model: UserProfile, as: 'profile' },\n          ],\n        });\n        done(null, {\n          id: user.id,\n          email: user.email,\n        });\n      }\n    } else {\n      const users = await User.findAll({\n        attributes: ['id', 'email'],\n        where: { '$logins.name$': loginName, '$logins.key$': profile.id },\n        include: [\n          {\n            attributes: ['name', 'key'],\n            model: UserLogin,\n            as: 'logins',\n            required: true,\n          },\n        ],\n      });\n      if (users.length) {\n        const user = users[0].get({ plain: true });\n        done(null, user);\n      } else {\n        let user = await User.findOne({ where: { email: profile._json.email } });\n        if (user) {\n          // There is already an account using this email address. Sign in to\n          // that account and link it with Facebook manually from Account Settings.\n          done(null);\n        } else {\n          user = await User.create({\n            email: profile._json.email,\n            emailConfirmed: true,\n            logins: [\n              { name: loginName, key: profile.id },\n            ],\n            claims: [\n              { type: claimType, value: accessToken },\n            ],\n            profile: {\n              displayName: profile.displayName,\n              gender: profile._json.gender,\n              picture: `https://graph.facebook.com/${profile.id}/picture?type=large`,\n            },\n          }, {\n            include: [\n              { model: UserLogin, as: 'logins' },\n              { model: UserClaim, as: 'claims' },\n              { model: UserProfile, as: 'profile' },\n            ],\n          });\n          done(null, {\n            id: user.id,\n            email: user.email,\n          });\n        }\n      }\n    }\n  };\n\n  fooBar().catch(done);\n}));\n\nexport default passport;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/auth.facebook.js\n// module id = 9\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\nmodule.exports = {\n  // Authentication\n  auth: {\n    jwt: { secret: process.env.JWT_SECRET || 'React Starter Kit' },\n    facebook: {\n      clientID: process.env.FACEBOOK_APP_ID || '2006619856232997',\n      clientSecret: process.env.FACEBOOK_APP_SECRET || '2466ea45b5f5d3d1b2227758c08f0922',\n      callbackURL: '/auth/facebook/callback'\n    },\n\n    google: {\n      id: process.env.GOOGLE_CLIENT_ID || '251410730550-ahcg0ou5mgfhl8hlui1urru7jn5s12km.apps.googleusercontent.com',\n      secret: process.env.GOOGLE_CLIENT_SECRET || 'Y8yR9yZAhm9jQ8FKAL8QIEcd',\n    },\n\n    twitter: {\n      key: process.env.TWITTER_CONSUMER_KEY || 'Ie20AZvLJI2lQD5Dsgxgjauns',\n      secret: process.env.TWITTER_CONSUMER_SECRET || 'KTZ6cxoKnEakQCeSpZlaUCJWGAlTEBJj0y2EMkUBujA7zWSvaQ',\n    },\n  },\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/passport/config.js\n// module id = 10\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\"use strict\";\nmodule.exports = (app) => {\n  let express = require('express')\n    ,router = express.Router();\n\n  router.use(\"/user\", require(\"./user.route\")(app));\n  return router;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/api/index.js\n// module id = 11\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\"use strict\";\nimport express from 'express';\nlet router = express.Router();\n\nrouter.get('/', (req, res) => {\n  res.json({ status: \"user info\" });\n});\n\nexport default router;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/api/user.route.js\n// module id = 12\n// module chunks = 0","/**\n * Created by hien.tran on 6/2/2017.\n */\n\n\"use strict\";\n\nimport express from 'express';\nimport fbPassport from '../passport/auth.facebook';\nlet router = express.Router();\n\nrouter.get('/', (req, res) => {\n  res.json({status: \"server runing\"});\n});\n\nrouter.post('/user', (req, res) => {\n  res.json({status: \"create user\"});\n});\n\nrouter.get('/auth/facebook',\n  fbPassport.authenticate('facebook', { scope: ['email', 'user_location'], session: false })\n);\n\nrouter.get('/auth/facebook/callback', (req, res, next) => {\n  fbPassport.authenticate('facebook', (err) => {\n    let rs = {\n      success: err,\n      message: \"login success\"\n    }\n    if(err) rs = { success: err, message: 'login fail' }\n    return res.json(rs);\n  })(req, res, next);\n});\n\nexport default router;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/server/routes/index.js\n// module id = 13\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"passport-facebook\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-facebook\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"randomstring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"randomstring\"\n// module id = 18\n// module chunks = 0"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;AChEA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5BA;;;;;;ACAA;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC3BA;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACXA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACZA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACjCA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;;;A","sourceRoot":""}